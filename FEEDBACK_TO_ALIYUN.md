# 关于 ESA Pages 边缘函数执行时间限制的反馈建议

## 反馈渠道

1. **工单系统**: 登录阿里云控制台 > 工单 > 提交工单 > 选择"边缘安全加速 ESA"产品
2. **产品反馈**: ESA 控制台右上角的"反馈"按钮
3. **天池比赛讨论区**: 在比赛页面的讨论区发帖反馈
4. **阿里云开发者社区**: https://developer.aliyun.com/

## 问题描述

当前 ESA Pages 边缘函数的执行时间限制为 **100ms**,这个限制对于实际的全栈应用开发来说过于严格,导致很多正常的后端操作无法完成。

**更严重的是:付费版本也是 100ms 限制,没有提供更高规格的选项。**

## 具体问题示例

### 1. 密码加密验证超时

**场景**: 用户登录时使用 bcrypt 验证密码

**实际耗时**:
- bcrypt.compare() 单次调用: 60-80ms
- 加上其他逻辑: 总计 80-120ms

**结果**: 超过 100ms 限制,返回 599 错误

```javascript
// 这段正常的登录代码在 ESA Pages 上无法运行
const isValid = await bcrypt.compare(password, user.password)
// Error: FatalCpuTime - 超过 100ms 限制
```

### 2. 数据库连接超时

**场景**: 连接 TiDB Cloud 数据库查询文章列表

**实际耗时**:
- 建立 MySQL 连接: 50-70ms
- 执行 SQL 查询: 30-50ms
- 总计: 80-120ms

**结果**: 超过 100ms 限制,无法使用任何传统数据库

```javascript
// 这段正常的数据库查询代码无法运行
const posts = await query('SELECT * FROM posts WHERE status = ?', ['published'])
// Error: 超过 100ms 限制
```

### 3. 第三方 API 调用超时

**场景**: 调用支付接口、短信接口等第三方服务

**实际耗时**:
- 网络请求往返: 50-150ms (取决于服务商)
- 数据处理: 10-20ms

**结果**: 大部分第三方 API 调用都会超时

### 4. 图片处理超时

**场景**: 上传图片后进行压缩、裁剪等处理

**实际耗时**:
- 图片解码: 30-50ms
- 图片处理: 50-100ms
- 总计: 80-150ms

**结果**: 无法进行任何图片处理操作

## 竞品对比

| 平台 | 免费版限制 | 付费版限制 |
|------|-----------|-----------|
| **ESA Pages** | 100ms | **100ms** (无升级选项) |
| Cloudflare Workers | 10ms (CPU time) | 50ms / 无限制 |
| Vercel Edge Functions | 25s | 60s |
| Netlify Edge Functions | 50ms | 可配置 |
| AWS Lambda@Edge | 5s | 30s |

**ESA Pages 的问题**:
1. 付费版没有提供更高规格的选项
2. 100ms 限制比竞品严格得多
3. 无法满足实际的全栈应用需求

## 建议的改进方案

### 方案 1: 分级规格(推荐)

| 规格 | 执行时间限制 | 适用场景 |
|------|-------------|---------|
| 基础版 | 100ms | 纯静态内容、简单 API |
| 标准版 | 500ms | 数据库查询、用户认证 |
| 专业版 | 2000ms | 复杂业务逻辑、第三方集成 |
| 企业版 | 5000ms | 数据处理、文件操作 |

### 方案 2: 按需付费

- 基础: 100ms (免费)
- 每增加 100ms: +¥5/百万次请求
- 用户可根据实际需求灵活配置

### 方案 3: 分离计费

- CPU 时间: 单独计费(类似 Cloudflare Workers)
- 总执行时间: 单独限制
- 允许 I/O 等待时间不计入 CPU 时间

## 实际影响

作为开发者,我正在开发一个博客系统参加 ESA Pages 大赛,但遇到以下问题:

1. **无法使用密码加密**: bcrypt 验证需要 60-80ms,超过限制
2. **无法连接数据库**: TiDB Cloud 连接需要 80-120ms,超过限制
3. **被迫使用模拟数据**: 无法展示真实的数据库集成能力
4. **付费版无升级选项**: 即使愿意付费,也无法获得更长的执行时间

这严重限制了 ESA Pages 的应用场景,使其只能用于:
- 纯静态网站
- 极简单的 API(不涉及数据库、加密等)

而无法用于:
- 真正的全栈应用
- 需要数据库的应用
- 需要用户认证的应用
- 需要第三方服务集成的应用

## 建议

希望阿里云能够:

1. **为付费用户提供更高规格的边缘函数**
   - 至少提供 500ms-1000ms 的选项
   - 允许用户根据需求选择合适的规格

2. **优化计费模型**
   - 区分 CPU 时间和总执行时间
   - I/O 等待时间不应计入限制

3. **提供混合部署方案**
   - 静态资源使用边缘节点
   - 复杂逻辑使用区域服务器(更长执行时间)

4. **文档说明**
   - 明确说明 100ms 限制的适用场景
   - 提供最佳实践指南
   - 说明哪些操作不适合在边缘函数中执行

## 联系方式

- 姓名: [你的姓名]
- 账号 ID: 1932368571706785
- 项目: ESA Blog Pro (参赛项目)
- GitHub: https://github.com/nike022/uublog

---

**总结**: 100ms 的执行时间限制严重限制了 ESA Pages 的应用场景,希望能够提供更灵活的规格选项,特别是为付费用户提供更长的执行时间。
